<!-- page container -->
<div class="container-fluid">
  <!-- page header -->
  <div class="row d-flex justify-content-center my-4">
    <div class="col-12 col-sm-12 col-md-10 col-lg-8 text-center">
      <h1 class="my-4 title">O que você quer assistir?</h1>
      <input id="q" class="form-control form-control-lg my-4" value="" type="text">
    </div>
  </div>

  <!-- algolia results div -->
  <div id="hits" class="row justify-content-center"></div>

  <!-- card grid -->
  <div class="row justify-content-center my-4">
    <!-- single card loop -->
    <% @movies.each do |movie| %>
    <div class="col-6 col-sm-6 col-md-3 col-lg-2">
      <div class="card-element mb-4">
        <!-- play poster -->
        <div class="card-play-wrap">
          <% if movie.photo.attached? %>
          <%= link_to movie.link, target: :_blank do %>
          <%= cl_image_tag movie.photo.key, width: 200, height: 300, crop: :fill, class: 'card-thumb' %>
          <div class="card-play"><i class="fas fa-play"></i></div>
          <% end %>
          <% end %>
        </div>
        <!-- end play poster -->
        <div class="card-info">
          <h2 class="border-bottom mb-2 pb-2 title"><%= link_to movie.name, movie_path(movie) %></h2>
          <p class="small">Plataforma: <%= movie.platform %></p>
          <p class="small"><%= movie.year %> | <%= movie.genre.name %> | <%= movie.duration %> min.</p>
          <%= link_to 'Leia mais', movie_path(movie), class: 'text-uppercase badge badge-primary'%>
        </div>
      </div>
    </div>
    <% end %>
    <!-- end single card loop -->
  </div>
  <!-- end card grid -->
  <!-- start algolia script -->
  <script type="text/javascript">
    const hitTemplate = `
      <div class="card-element mb-4">
        <!-- play poster -->
        <div class="card-play-wrap">
          <a href="{{link}}" alt="{{name}}" target="_blank">
            <img src="{{photo.key}}" class="card-thumb">
            <div class="card-play"><i class="fas fa-play"></i></div>
          </a>
        </div>
        <!-- end play poster -->
        <div class="card-info">
          <h2 class="border-bottom mb-2 pb-2 title">
          <a href="movies/{{id}}" alt="{{name}}">{{name}}</a></h2>
          <p class="small">Plataforma: {{platform}}</p>
          <p class="small">{{year}} | {{genre.name}} | {{duration}} min.</p>
        </div>
      </div>`;

    const search = instantsearch({
      appId: '<%= ENV['ALGOLIASEARCH_APPLICATION_ID'] %>',
      apiKey: '<%= ENV['ALGOLIASEARCH_API_KEY_SEARCH'] %>',
      indexName: '<%= Movie.index_name %>',
      urlSync: true
    });

    search.addWidget(
      instantsearch.widgets.searchBox({
        container: '#q',
        placeholder: 'Digite um tema, assunto, gênero, nome, diretor, país...',
        autofocus: true,
        poweredBy: false
      })
    );

    search.addWidget(
      instantsearch.widgets.hits({
        container: '#hits',
        templates: {
          empty: 'Nenhum resultado 🍿Tente outra vez...',
          item: hitTemplate
        },
        cssClasses: {
          item: 'col-6 col-sm-6 col-md-3 col-lg-2',
        },
        hitsPerPage: 10
      })
    );

    search.start();
  </script>
</div>
<!-- end container -->
